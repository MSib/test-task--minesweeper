import{o as te,m as Q,p as U,q as X,x as oe,r as y,y as le,z as se,A as re,B as ie,C as ae,c as Y,D as O,u as ue,E as ce}from"./index-C7AjCSbV.js";function fe(e){return re()?(ie(e),!0):!1}const de=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ve=Object.prototype.toString,me=e=>ve.call(e)==="[object Object]",pe=()=>{};function he(...e){if(e.length!==1)return oe(...e);const n=e[0];return typeof n=="function"?U(le(()=>({get:n,set:pe}))):y(n)}function ge(e,n){function t(...l){return new Promise((r,f)=>{Promise.resolve(e(()=>n.apply(this,l),{fn:n,thisArg:this,args:l})).then(r).catch(f)})}return t}const Z=e=>e();function ye(e=Z,n={}){const{initialState:t="active"}=n,l=he(t==="active");function r(){l.value=!1}function f(){l.value=!0}const i=(...s)=>{l.value&&e(...s)};return{isActive:U(l),pause:r,resume:f,eventFilter:i}}function J(e){return Array.isArray(e)?e:[e]}function we(e){return se()}function Se(e,n,t={}){const{eventFilter:l=Z,...r}=t;return X(e,ge(l,n),r)}function be(e,n,t={}){const{eventFilter:l,initialState:r="active",...f}=t,{eventFilter:i,pause:s,resume:u,isActive:c}=ye(l,{initialState:r});return{stop:Se(e,n,{...f,eventFilter:i}),pause:s,resume:u,isActive:c}}function Ce(e,n=!0,t){we()?te(e,t):n?e():Q(e)}function Ae(e,n,t){return X(e,n,{...t,immediate:!0})}const j=de?window:void 0;function Ee(e){var n;const t=O(e);return(n=t==null?void 0:t.$el)!=null?n:t}function $(...e){const n=[],t=()=>{n.forEach(s=>s()),n.length=0},l=(s,u,c,d)=>(s.addEventListener(u,c,d),()=>s.removeEventListener(u,c,d)),r=Y(()=>{const s=J(O(e[0])).filter(u=>u!=null);return s.every(u=>typeof u!="string")?s:void 0}),f=Ae(()=>{var s,u;return[(u=(s=r.value)==null?void 0:s.map(c=>Ee(c)))!=null?u:[j].filter(c=>c!=null),J(O(r.value?e[1]:e[0])),J(ue(r.value?e[2]:e[1])),O(r.value?e[3]:e[2])]},([s,u,c,d])=>{if(t(),!(s!=null&&s.length)||!(u!=null&&u.length)||!(c!=null&&c.length))return;const v=me(d)?{...d}:d;n.push(...s.flatMap(m=>u.flatMap(p=>c.map(A=>l(m,p,A,v)))))},{flush:"post"}),i=()=>{f(),t()};return fe(t),i}const x=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},V="__vueuse_ssr_handlers__",Fe=Me();function Me(){return V in x||(x[V]=x[V]||{}),x[V]}function Oe(e,n){return Fe[e]||n}function Ne(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const We={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},q="vueuse-storage";function Re(e,n,t,l={}){var r;const{flush:f="pre",deep:i=!0,listenToStorageChanges:s=!0,writeDefaults:u=!0,mergeDefaults:c=!1,shallow:d,window:v=j,eventFilter:m,onError:p=a=>{console.error(a)},initOnMounted:A}=l,b=(d?ae:y)(typeof n=="function"?n():n),w=Y(()=>O(e));if(!t)try{t=Oe("getDefaultStorage",()=>{var a;return(a=j)==null?void 0:a.localStorage})()}catch(a){p(a)}if(!t)return b;const S=O(n),M=Ne(S),E=(r=l.serializer)!=null?r:We[M],{pause:_,resume:R}=be(b,()=>L(b.value),{flush:f,deep:i,eventFilter:m});X(w,()=>F(),{flush:f}),v&&s&&Ce(()=>{t instanceof Storage?$(v,"storage",F,{passive:!0}):$(v,q,T),A&&F()}),A||F();function D(a,g){if(v){const o={key:w.value,oldValue:a,newValue:g,storageArea:t};v.dispatchEvent(t instanceof Storage?new StorageEvent("storage",o):new CustomEvent(q,{detail:o}))}}function L(a){try{const g=t.getItem(w.value);if(a==null)D(g,null),t.removeItem(w.value);else{const o=E.write(a);g!==o&&(t.setItem(w.value,o),D(g,o))}}catch(g){p(g)}}function I(a){const g=a?a.newValue:t.getItem(w.value);if(g==null)return u&&S!=null&&t.setItem(w.value,E.write(S)),S;if(!a&&c){const o=E.read(g);return typeof c=="function"?c(o,S):M==="object"&&!Array.isArray(o)?{...S,...o}:o}else return typeof g!="string"?g:E.read(g)}function F(a){if(!(a&&a.storageArea!==t)){if(a&&a.key==null){b.value=S;return}if(!(a&&a.key!==w.value)){_();try{(a==null?void 0:a.newValue)!==E.write(b.value)&&(b.value=I(a))}catch(g){p(g)}finally{a?Q(R):R()}}}}function T(a){F(a.detail)}return b}function De(e,n,t={}){const{window:l=j}=t;return Re(e,n,l==null?void 0:l.localStorage,t)}const P=[{name:"easy",label:"легкий",cols:8,rows:8,mines:10},{name:"medium",label:"средний",cols:16,rows:16,mines:40},{name:"hard",label:"сложный",cols:32,rows:16,mines:100},{name:"custom",label:"пользовательский",cols:32,rows:16,mines:100}],N=9,ee=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];function Ie(e,n,t){const{rows:l,cols:r}=e,f=Array.from({length:l},()=>Array.from({length:r},()=>0)),i=Te(f,e.mines,n-1,t-1);return ke(i)}function Te(e,n,t,l){let r=0;for(;r<n;){const f=B(0,e.length-1),i=B(0,e[0].length-1);!(f===t&&i===l)&&e[f][i]<N&&(e[f][i]=N,r++)}return e}function ke(e){const n=e.length-1,t=e[0].length-1,l=e;for(const r in e)for(const f in e[r]){const i=Number(r),s=Number(f);if(e[i][s]===N)for(const c of ee){const d=i+c[0],v=s+c[1],m=d>=0&&d<=n,p=v>=0&&v<=t;!m||!p||l[d][v]!==N&&l[d][v]++}}return l}function xe(e,n,t){if(n=n-1,t=t-1,!(e[n][t]===0))return[[n,t]];const r=e.length-1,f=e[0].length-1,i=[[n,t]],s=[],u=[];for(;i.length;){const[c,d]=i[0];s.push(i[0]),u.push(i[0]),i.splice(0,1);for(const v of ee){const m=c+v[0],p=d+v[1],A=m>=0&&m<=r,b=p>=0&&p<=f;if(!A||!b)continue;const w=e[m][p];if(w>0){if(H(u,[m,p]))continue;u.push([m,p])}else if(w===0){const S=H(s,[m,p]),M=H(i,[m,p]);if(S||M)continue;i.push([m,p])}}}return u}function B(e,n){return Math.floor(Math.random()*(n-e+1))+e}function K(e,n,t){return(e-1)*t+n}function H(e,[n,t]){return!!e.reduce((r,f)=>(r.push(f.toString()),r),[]).includes([n,t].toString())}const _e=ce("main",()=>{const e=y(!0),n=y(P.find(o=>o.name==="easy")),t=y(null),l=y([]),r=y(null),f=y(null),i=y(0),s=y(0),u=y(void 0),c=y(0),d=y(!1),v=y(!1),m=De("winners",[]);function p(){e.value=!e.value}function A(o){n.value=o}function b(o){const h=P.find(C=>C.name===o.mode);h&&(h.name==="custom"&&(h.rows=o.rows,h.cols=o.cols,h.mines=o.mines),n.value=h,i.value=n.value.mines,c.value=n.value.rows*n.value.cols-n.value.mines,d.value=!1,v.value=!1,e.value=!1)}function w(){t.value&&(F(),t.value=null,l.value.forEach(o=>{o.reset()}),i.value=n.value.mines,c.value=n.value.rows*n.value.cols-n.value.mines,d.value=!1,v.value=!1)}function S(o){l.value=o,t.value=null}function M(o,h){r.value=o??null,f.value=h??null}function E(o,h){if(v.value)return;t.value||(t.value=Ie(n.value,o,h),L());const W=t.value[o-1][h-1]===N;xe(t.value,o,h).forEach(([z,G])=>{const ne=K(z+1,G+1,n.value.cols);l.value[ne-1].open(t.value[z][G])&&t.value[z][G]!==N&&c.value--}),c.value===0&&!W&&T(!0),W&&T(!1)}function _(o,h){if(v.value)return;const C=K(o,h,n.value.cols);l.value[C-1].marked()}function R(){i.value++}function D(){i.value--}function L(){const o=Date.now();u.value=setInterval(()=>{s.value=Math.floor((Date.now()-o)/1e3)},1e3)}function I(){clearInterval(u.value),u.value=void 0}function F(){u.value&&I(),s.value=0}function T(o=!1){var h;I(),v.value=!0,o&&(d.value=!0,(h=r.value)==null||h.showModal())}function a(o){if(d.value){let C=[...m.value];C.push({name:o||"Аноним",time:s.value,mode:n.value.label}),C.sort((W,k)=>W.time-k.time),C=C.filter((W,k)=>k<10),m.value=C}}function g(){m.value=[]}return{settingsAreDisplayed:e,toggleDisplayOfSettings:p,modes:P,selectedMode:n,selectMode:A,startGame:b,restartGame:w,cellsRef:l,setCellsRef:S,setDialogRef:M,cellClicked:E,toggleFlag:_,flagsAvailable:i,incrementFlag:R,decrementFlag:D,timer:s,won:d,gameOver:v,winners:m,addWinner:a,clearWinners:g}});export{N as M,K as c,_e as u};
