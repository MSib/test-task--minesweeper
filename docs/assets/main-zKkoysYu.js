import{f as te,p as ne,q as ie,x as q,y as ae,r as b,z as ce,A as fe,B as de,C as ve,D as me,c as le,E as I,e as pe,G as he}from"./index-DN1Ik6vw.js";function ge(e){return de()?(ve(e),!0):!1}const ye=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const we=Object.prototype.toString,Se=e=>we.call(e)==="[object Object]",be=()=>{};function Ee(...e){if(e.length!==1)return ae(...e);const t=e[0];return typeof t=="function"?ie(ce(()=>({get:t,set:be}))):b(t)}function Ce(e,t){function n(...o){return new Promise((i,p)=>{Promise.resolve(e(()=>t.apply(this,o),{fn:t,thisArg:this,args:o})).then(i).catch(p)})}return n}const se=e=>e();function Te(e=se,t={}){const{initialState:n="active"}=t,o=Ee(n==="active");function i(){o.value=!1}function p(){o.value=!0}const r=(...l)=>{o.value&&e(...l)};return{isActive:ie(o),pause:i,resume:p,eventFilter:r}}function H(e){return Array.isArray(e)?e:[e]}function Ae(e){return fe()}function Me(e,t,n={}){const{eventFilter:o=se,...i}=n;return q(e,Ce(o,t),i)}function Fe(e,t,n={}){const{eventFilter:o,initialState:i="active",...p}=n,{eventFilter:r,pause:l,resume:u,isActive:a}=Te(o,{initialState:i});return{stop:Me(e,t,{...p,eventFilter:r}),pause:l,resume:u,isActive:a}}function De(e,t=!0,n){Ae()?te(e,n):t?e():ne(e)}function Oe(e,t,n){return q(e,t,{...n,immediate:!0})}const G=ye?window:void 0;function Re(e){var t;const n=I(e);return(t=n==null?void 0:n.$el)!=null?t:n}function U(...e){const t=[],n=()=>{t.forEach(l=>l()),t.length=0},o=(l,u,a,g)=>(l.addEventListener(u,a,g),()=>l.removeEventListener(u,a,g)),i=le(()=>{const l=H(I(e[0])).filter(u=>u!=null);return l.every(u=>typeof u!="string")?l:void 0}),p=Oe(()=>{var l,u;return[(u=(l=i.value)==null?void 0:l.map(a=>Re(a)))!=null?u:[G].filter(a=>a!=null),H(I(i.value?e[1]:e[0])),H(pe(i.value?e[2]:e[1])),I(i.value?e[3]:e[2])]},([l,u,a,g])=>{if(n(),!(l!=null&&l.length)||!(u!=null&&u.length)||!(a!=null&&a.length))return;const h=Se(g)?{...g}:g;t.push(...l.flatMap(f=>u.flatMap(d=>a.map(C=>o(f,d,C,h)))))},{flush:"post"}),r=()=>{p(),n()};return ge(n),r}const V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_="__vueuse_ssr_handlers__",Ie=Ne();function Ne(){return _ in V||(V[_]=V[_]||{}),V[_]}function We(e,t){return Ie[e]||t}function Le(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const Pe={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},Y="vueuse-storage";function xe(e,t,n,o={}){var i;const{flush:p="pre",deep:r=!0,listenToStorageChanges:l=!0,writeDefaults:u=!0,mergeDefaults:a=!1,shallow:g,window:h=G,eventFilter:f,onError:d=m=>{console.error(m)},initOnMounted:C}=o,E=(g?me:b)(typeof t=="function"?t():t),S=le(()=>I(e));if(!n)try{n=We("getDefaultStorage",()=>{var m;return(m=G)==null?void 0:m.localStorage})()}catch(m){d(m)}if(!n)return E;const s=I(t),v=Le(s),T=(i=o.serializer)!=null?i:Pe[v],{pause:j,resume:W}=Fe(E,()=>z(E.value),{flush:p,deep:r,eventFilter:f});q(S,()=>D(),{flush:p}),h&&l&&De(()=>{n instanceof Storage?U(h,"storage",D,{passive:!0}):U(h,Y,B),C&&D()}),C||D();function L(m,y){if(h){const A={key:S.value,oldValue:m,newValue:y,storageArea:n};h.dispatchEvent(n instanceof Storage?new StorageEvent("storage",A):new CustomEvent(Y,{detail:A}))}}function z(m){try{const y=n.getItem(S.value);if(m==null)L(y,null),n.removeItem(S.value);else{const A=T.write(m);y!==A&&(n.setItem(S.value,A),L(y,A))}}catch(y){d(y)}}function J(m){const y=m?m.newValue:n.getItem(S.value);if(y==null)return u&&s!=null&&n.setItem(S.value,T.write(s)),s;if(!m&&a){const A=T.read(y);return typeof a=="function"?a(A,s):v==="object"&&!Array.isArray(A)?{...s,...A}:A}else return typeof y!="string"?y:T.read(y)}function D(m){if(!(m&&m.storageArea!==n)){if(m&&m.key==null){E.value=s;return}if(!(m&&m.key!==S.value)){j();try{(m==null?void 0:m.newValue)!==T.write(E.value)&&(E.value=J(m))}catch(y){d(y)}finally{m?ne(W):W()}}}}function B(m){D(m.detail)}return E}function Ve(e,t,n={}){const{window:o=G}=n;return xe(e,t,o==null?void 0:o.localStorage,n)}const X=[{name:"easy",label:"легкий",cols:8,rows:8,mines:10},{name:"medium",label:"средний",cols:16,rows:16,mines:40},{name:"hard",label:"сложный",cols:32,rows:16,mines:100},{name:"custom",label:"пользовательский",cols:32,rows:16,mines:100}],R=9,K=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];function _e(e,t,n){const{rows:o,cols:i}=e,p=Array.from({length:o},()=>Array.from({length:i},()=>0)),r=ke(p,e.mines,t-1,n-1);return Ge(r)}function ke(e,t,n,o){let i=0;const p=Math.min(t,e.length*e[0].length-1);for(;i<p;){const r=Z(0,e.length-1),l=Z(0,e[0].length-1);!(r===n&&l===o)&&e[r][l]<R&&(e[r][l]=R,i++)}return e}function Ge(e){const t=e.length-1,n=e[0].length-1,o=e;for(const i in e)for(const p in e[i]){const r=Number(i),l=Number(p);if(e[r][l]===R)for(const a of K){const g=r+a[0],h=l+a[1],f=g>=0&&g<=t,d=h>=0&&h<=n;!f||!d||o[g][h]!==R&&o[g][h]++}}return o}function je(e,t,n){if(t=t-1,n=n-1,!(e[t][n]===0))return[[t,n]];const i=e.length-1,p=e[0].length-1,r=[[t,n]],l=[],u=[];for(;r.length;){const[a,g]=r[0];l.push(r[0]),u.push(r[0]),r.splice(0,1);for(const h of K){const f=a+h[0],d=g+h[1],C=f>=0&&f<=i,E=d>=0&&d<=p;if(!C||!E)continue;const S=e[f][d];if(S>0){if(N(u,[f,d]))continue;u.push([f,d])}else if(S===0){const s=N(l,[f,d]),v=N(r,[f,d]);if(s||v)continue;r.push([f,d])}}}return u}function ze(e,t,n){if(t=t-1,n=n-1,!(e[t][n]===0))return[[t,n]];const i=e.length-1,p=e[0].length-1,r=[[t,n]],l=[],u=[];for(;r.length;){const[a,g]=r[0];l.push(r[0]),u.push(r[0]),r.splice(0,1);for(const h of K){const f=a+h[0],d=g+h[1],C=f>=0&&f<=i,E=d>=0&&d<=p;if(!C||!E)continue;const S=e[f][d];if(S>0){if(N(u,[f,d]))continue;u.push([f,d])}else if(S===0){const s=N(l,[f,d]),v=N(r,[f,d]);if(s||v)continue;r.push([f,d])}}}return u}function Z(e,t){return Math.floor(Math.random()*(t-e+1))+e}function ee(e,t,n){return(e-1)*n+t}function N(e,[t,n]){return!!e.reduce((i,p)=>(i.push(p.toString()),i),[]).includes([t,n].toString())}const F={left:0,middle:1,right:2},k={mouse:"mouse",pen:"pen",touch:"touch"};function Je(){return"ontouchstart"in window||navigator.maxTouchPoints>0||window.matchMedia("(pointer: coarse)").matches}function Xe(e){const n={pointerId:0,button:null,type:null,isMouse:!1,isTouch:!1,isPen:!1,start:!1,end:!1,cancel:!1,pressTime:0,longPress:!1};let o=0,i=b({...n}),p=!1;function r(s){s.isPrimary&&(g(),h(s),E())}function l(s){u(s,!0)}function u(s,v=!1){s.isPrimary&&i.value.pointerId===s.pointerId&&(i.value.start=!1,v?i.value.cancel=!0:i.value.end=!0,C(),E(),a())}function a(){i.value={...n},o=0}function g(){a()}function h(s){const v=f(s.pointerType),T={pointerId:s.pointerId,button:d(s.button),type:v,isMouse:v===k.mouse,isTouch:v===k.touch,isPen:v===k.pen,start:!0};o=Date.now(),i.value={...i.value,...T}}function f(s){try{return k[s]}catch{return null}}function d(s){switch(s){case F.left:return F.left;case F.middle:return F.middle;case F.right:return F.right;default:return null}}function C(){const s=Date.now()-o;s>0&&(i.value.pressTime=s,i.value.longPress=s>500)}function E(){var v;const s=(e==null?void 0:e.touch)!==!1||!i.value.isTouch;if((v=e==null?void 0:e.target)!=null&&v.value&&s){const T=new CustomEvent("pointerClick",{detail:{...i.value}});e.target.value.dispatchEvent(T)}}function S(){var s;if((s=e==null?void 0:e.target)!=null&&s.value){p=!1;const v=e.target.value;v.removeEventListener("pointerdown",r),v.removeEventListener("pointerup",u),v.removeEventListener("pointerleave",l),v.removeEventListener("pointercancel",l)}}return te(()=>{var s;if((s=e==null?void 0:e.target)!=null&&s.value){p=!0;const v=e.target.value;v.addEventListener("pointerdown",r),v.addEventListener("pointerup",u),v.addEventListener("pointerleave",l),v.addEventListener("pointercancel",l),v.addEventListener("contextmenu",T=>T.preventDefault())}}),{active:p,pointerStatus:i,remove:S}}const qe=he("main",()=>{const e=b(!0),t=b(X.find(c=>c.name==="easy")),n=b(null),o=b([]),i=b(null),p=b(null),r=b(0),l=b(0),u=b(void 0),a=b(0),g=b(!1),h=b(!1),f=Ve("winners",[]),d=b(Je()),C=b(F.left);function E(c){C.value=c}function S(c){d.value=c}function s(){e.value=!e.value}function v(c){t.value=c}function T(c){const w=X.find(M=>M.name===c.mode);w&&(w.name==="custom"&&(w.rows=c.rows,w.cols=c.cols,w.mines=c.mines),t.value=w,r.value=t.value.mines,a.value=t.value.rows*t.value.cols-t.value.mines,g.value=!1,h.value=!1,e.value=!1)}function j(){n.value&&(C.value=F.left,A(),n.value=null,o.value.forEach(c=>{c.reset()}),r.value=t.value.mines,a.value=t.value.rows*t.value.cols-t.value.mines,g.value=!1,h.value=!1)}function W(c){o.value=c,n.value=null}function L(c,w){i.value=c??null,p.value=w??null}function z(c,w,M=!1){if(h.value||M&&!n.value)return;n.value||(n.value=_e(t.value,c,w),m());let O=n.value[c-1][w-1]===R;(M?ze(n.value,c,w):je(n.value,c,w)).forEach(([P,x])=>{const ue=ee(P+1,x+1,t.value.cols);o.value[ue-1].open(n.value[P][x])&&n.value[P][x]!==R&&a.value--,n.value[P][x]===R&&(O=!0)}),a.value===0&&!O&&Q(!0),O&&Q(!1)}function J(c,w){if(h.value)return;const M=ee(c,w,t.value.cols);o.value[M-1].marked()}function D(){r.value++}function B(){r.value--}function m(){y();const c=Date.now();u.value=setInterval(()=>{l.value=Math.floor((Date.now()-c)/1e3)},1e3)}function y(){clearInterval(u.value),u.value=void 0}function A(){u.value&&y(),l.value=0}function Q(c=!1){var w;y(),h.value=!0,c&&(g.value=!0,(w=i.value)==null||w.showModal())}function oe(c){if(g.value){let M=[...f.value];M.push({name:c||"Аноним",time:l.value,mode:t.value.label}),M.sort(($,O)=>$.time-O.time),M=M.filter(($,O)=>O<10),f.value=M}}function re(){f.value=[]}return{settingsAreDisplayed:e,toggleDisplayOfSettings:s,modes:X,selectedMode:t,selectMode:v,startGame:T,restartGame:j,cellsRef:o,setCellsRef:W,setDialogRef:L,cellClicked:z,toggleFlag:J,flagsAvailable:r,incrementFlag:D,decrementFlag:B,timer:l,won:g,gameOver:h,winners:f,addWinner:oe,clearWinners:re,isTouchDevice:d,changeDevice:S,selectedEmulationButton:C,changeEmulationButton:E}});export{R as M,qe as a,F as b,ee as c,Je as i,Xe as u};
